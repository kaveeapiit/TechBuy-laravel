#!/bin/bash

echo "üîß AZURE DATABASE FIX COMMANDS"
echo "==============================="
echo ""
echo "If admin registration still fails after deployment, run these commands on Azure:"
echo ""
echo "# 1. Mark migration as completed (if needed)"
echo "php artisan tinker --execute=\"DB::table('migrations')->insertOrIgnore(['migration' => '2025_09_23_155354_create_admins_table', 'batch' => DB::table('migrations')->max('batch') + 1]);\""
echo ""
echo "# 2. Update role constraints (if needed)"
echo "php artisan tinker --execute=\"DB::statement('ALTER TABLE admins DROP CONSTRAINT IF EXISTS admins_role_check');\""
echo "php artisan tinker --execute=\"DB::statement('ALTER TABLE admins ADD CONSTRAINT admins_role_check CHECK (role IN (\\\"super_admin\\\", \\\"admin\\\", \\\"moderator\\\"))');\""
echo ""
echo "# 3. Clear cache"
echo "php artisan config:clear"
echo "php artisan cache:clear"
echo "php artisan route:clear"
echo ""
echo "üîç How to run these on Azure:"
echo "1. Go to Azure Portal ‚Üí App Service ‚Üí SSH/Advanced Tools"
echo "2. Open Kudu console or SSH"
echo "3. Navigate to /home/site/wwwroot"
echo "4. Run the commands above"
echo ""
echo "üìä Or check deployment logs:"
echo "Azure Portal ‚Üí App Service ‚Üí Log stream"
